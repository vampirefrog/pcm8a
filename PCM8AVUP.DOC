		ＰＣＭ８Ａバージョンアップ履歴

0.00〜0.41	省略

0.42	94/5/4
	ＰＣＭ→ＡＤＰＣＭ変換テーブルを少々変更。ノイズが減少した。

0.43	94/5/22
	PCM8.X が常駐している状態で PCM8A CLR とすると、PCM8.X を常駐解除して
	しまうバグを修正。
	ＩＯＣＳで、キャンセルした出力が一時停止解除で出力されてしまうバグを修
	正。これに伴い、ＩＯＣＳ一時停止解除禁止フラグを追加。
	$FFF0 コール（ＰＣＭ８Ａ割り込みフラグチェック）、$FFF1 コール（ＰＣＭ
	８Ａ内部初期化）を正式サポートしてマニュアルに追加。

0.44	94/6/8
	ラスター割り込み対応を少々。
	数字から始まるマクロ名の修正（HAS v3.x でアセンブルできなかった）。
	ファンクションコール処理を少し高速化。

0.45	94/6/23
	割り込みマスク処理を少し変更。
	定位変更処理を少し変更。

0.46	94/7/8
	ＡＤＰＣＭ→ＰＣＭ変換の高速化少々。

0.47	94/8/20
	定位変更時のノイズを少し低減。
	PCM8.X に対する PCM8A CLR の処理を少し変更。
	未公開だった拡張チャンネル用ファンクションコールを公開。
	単音再生時に再生周波数や定位の変更ができなかったのを修正。

0.48	94/10/2
	ラスター割り込みへの配慮を少し強化

0.50	95/1/31
	チャンネル数・処理バイト数・音量可変範囲を常駐時及び常駐後に変更可能に
	した。
	周波数範囲を拡張（ 20.8KHz と 31.2KHz を追加）。
	機能追加と、ループ展開の減少により、１０ＭＨｚマシンでは更に重くなって
	しまったが、６８０３０の命令キャッシュがかなり効くようになった。
	ＡＤＰＣＭのクロックアップに暫定対応（したつもり）。
	０４０ｔｕｒｂｏに暫定対応（していないかもしれない）。

0.51	95/4/24
	単音再生モードで出力停止(D0=$000x,$001xでD2=0)を行うと、ADPCMの周波数
	モードを変更してしまうバグを修正。
	PCM8ATEC.DOCのミスを修正($01F8コールのシステム情報取得の指定方法)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
●暫定仕様について

　以下には、動作確認不足のため、動作保証できない仕様について触れています。
　（本来、公開すべきではないのかもしれませんが、動作確認の見込みが立っていない
　　ため、暫定として公開に踏み切ったものです）
　今後のバージョンアップに伴う仕様変更の可能性や、記述が間違っている可能性があ
り、本内容についての保証は一切ありませんので注意してください。

（１）ＡＤＰＣＭのクロックアップ対応

　完全な動作確認を行っていません。

　Ｏｈ！Ｘ　１９９４年８月号掲載の瀧氏の記事「内蔵ＡＤ ＰＣＭ高音質化計画」に
従い、仕様の拡張及び追加を行いました。
　仕様の詳細は以下の通りです。

★ＡＤＰＣＭのモードについて

　・コマンドラインのオプションによる指定

	/M[n]	: ADPCMｸﾛｯｸﾓｰﾄﾞ指定 (通常:0)
		   n =	0   :4M/8M	(MODE0)
			1   :16M/8M	(MODE1)
			2   :4M/8M/16M	(MODE2)
			     (単位:Hz)
			A   :自動判定(MODE0〜2を自動で判別します)
		       省略 :環境変数(OPM_CT1)参照

	/F[n]	: 動作基準周波数指定 (通常:0)
		   n =	0   :15.6K
			1   :20.8K
			2   :31.2K
			     (単位:Hz)
		       省略 :最高周波数(-M の指定に従う)

　・ファンクションコールによる指定

	呼出：	D0.W	$01F7

		D1.L	＜ 0	：ADPCMﾓｰﾄﾞ取得
			≧ 0	：ADPCMﾓｰﾄﾞ設定

				ﾋﾞｯﾄ
				31〜16	：無効
					  (0をセットしておくこと)
				15〜 8	：ADPCMｸﾛｯｸﾓｰﾄﾞ
					   $FF	:前の値を保持
					    0	:4M/8M     (MODE0)
					    1	:16M/8M    (MODE1)
					    2	:4M/8M/16M (MODE2)
						 (単位:Hz)
				 7〜 0	：動作基準周波数
					   $FF	:前の値を保持
					    0	:15.6K
					    1	:20.8K
					    2	:31.2K
						 (単位:Hz)

	戻値：	D0.L	（変更前の）ADPCMﾓｰﾄﾞ情報

				ﾋﾞｯﾄ
				15〜 8	：ADPCMｸﾛｯｸﾓｰﾄﾞ
					    0	:4M/8M     (MODE0)
					    1	:16M/8M    (MODE1)
					    2	:4M/8M/16M (MODE2)
						 (単位:Hz)
				 7〜 0	：動作基準周波数
					    0	:15.6K
					    1	:20.8K
					    2	:31.2K
						 (単位:Hz)
				※他のﾋﾞｯﾄは 0

　ＡＤＰＣＭのクロックモードは３種類をサポートしています。

    MODE0 (-M0)	：無改造時に指定
		　ＯＰＭのＣＴ１ピンで 4MHz/8MHz の切り替えを行います。
		　-F オプションで 0 以外を指定しても無視します。

    MODE1 (-M1)	：Ｏｈ！Ｘ掲載の回路に従った改造を行った場合に指定
		　ＯＰＭのＣＴ１ピンで 16MHz/8MHz の切り替えを行います。

    MODE2 (-M2)	：従来の周波数をそのまま残して、クロックアップのモードを追加
		　する改造を行った場合に指定
		　幾つかの信号を元に 4MHz/8MHz/16MHz の切り替えを行います。

　環境変数を参照する場合、以下のように設定されている必要があります。

    MODE0 同等	：OPM_CT1が未定義 または OPM_CT1=4

    MODE1 同等	：OPM_CT1=16

    MODE2 同等	：OPM_CT1=4/16 または OPM_CT1=16/4

　以下に、それぞれの回路の略図と真理値表を示します。

	ＭＯＤＥ０

		  無改造の回路そのままのため、回路図は省略

				  真理値表
		┌────┬────┬────┬──────┐
		│ OPM CT1│ PPI PC3│ PPI PC2│ADPCM 周波数│
		├────┼────┼────┼──────┤
		│    1   │    0   │    0   │    3.9KHz  │
		├────┼────┼────┼──────┤
		│    1   │    0   │    1   │    5.2KHz  │
		├────┼────┼────┼──────┤
		│    0   │    0   │    0   │    7.8KHz  │
		├────┼────┼────┼──────┤
		│    0   │    0   │    1   │   10.4KHz  │
		├────┼────┼────┼──────┤
		│    0   │    1   │    0   │   15.6KHz  │
		└────┴────┴────┴──────┘


	ＭＯＤＥ１
				     74HC157
			OPM CT1 →───┐1
		  (YM2151 8pin)	    ┏━┷━┓
				   2┃  Ｓ  ┃
			  8MHz	→─┨1A    ┃4
				   3┃    1Y┠─→  MSM6258 XT(*)
			 16MHz  →─┨1B    ┃	    入力のﾊﾟﾀｰﾝはｶｯﾄ
				  15┃      ┃
			GND(0V) ──┨Ｇ    ┃
				    ┗━━━┛

		(*) ピン番号はパッケージ形状により異なる
		┌──────┬──────┬────┐
		│   型  格   │ ﾊﾟｯｹｰｼﾞ形状│   XT   │
		├──────┼──────┼────┤
		│            │  DIP 40pin │  13pin │
		│ MSM6258    ├──────┼────┤
		│            │  QFP 44pin │   9pin │
		└──────┴──────┴────┘

				  真理値表
		┌────┬────┬────┬──────┐
		│ OPM CT1│ PPI PC3│ PPI PC2│ADPCM 周波数│
		├────┼────┼────┼──────┤
		│    0   │    0   │    0   │    7.8KHz  │
		├────┼────┼────┼──────┤
		│    0   │    0   │    1   │   10.4KHz  │
		├────┼────┼────┼──────┤
		│    0   │    1   │    0   │   15.6KHz  │
		├────┼────┼────┼──────┤
		│    1   │    0   │    1   │   20.8KHz  │
		├────┼────┼────┼──────┤
		│    1   │    1   │    0   │   31.2KHz  │
		└────┴────┴────┴──────┘


	ＭＯＤＥ２
				     74HC352
		     PPI PC3(*) →────┐
					  │
			OPM CT1 →──┐2 │14
		  (YM2151 8pin)     ┏┷━┷┓
				   6┃Ｂ  Ａ┃
				┌─┨1C0   ┃
			 8MHz →┤ 5┃      ┃
				└─┨1C1   ┃7
				   4┃    1Y┠─→  MSM6258 XT(*)
			 4MHz →──┨1C2   ┃	    入力のﾊﾟﾀｰﾝはｶｯﾄ
				   3┃      ┃
			16MHz →──┨1C3   ┃
				   1┃      ┃
		      GND(0V) ───┨1G    ┃
				    ┃      ┃
				  10┃      ┃
		      VCC(5V) ───┨2C0   ┃
				  11┃      ┃
		      GND(0V) ───┨2C1   ┃9
				  12┃    2Y┠─→  MSM6258 S2(*)
		      VCC(5V) ───┨2C2   ┃	    入力のﾊﾟﾀｰﾝはｶｯﾄ
				  13┃      ┃
		   PPI PC2(*) →──┨2C3   ┃
				  15┃      ┃
		      GND(0V) ───┨2G    ┃
				    ┗━━━┛

		(*) ピン番号はパッケージ形状により異なる
		┌──────┬──────┬────┬────┐
		│   型  格   │ ﾊﾟｯｹｰｼﾞ形状│ PPI PC2│ PPI PC3│
		├──────┼──────┼────┼────┤
		│ UPD8255AC-2│  DIP 40pin │  16pin │  17pin │
		├──────┼──────┼────┼────┤
		│ MSM82C55   │  QFP 44pin │  11pin │  13pin │
		└──────┴──────┴────┴────┘
		┌──────┬──────┬────┬────┐
		│   型  格   │ ﾊﾟｯｹｰｼﾞ形状│   XT   │   S2   │
		├──────┼──────┼────┼────┤
		│            │  DIP 40pin │  13pin │  11pin │
		│ MSM6258    ├──────┼────┼────┤
		│            │  QFP 44pin │   9pin │   7pin │
		└──────┴──────┴────┴────┘

				  真理値表
		┌────┬────┬────┬──────┐
		│ OPM CT1│ PPI PC3│ PPI PC2│ADPCM 周波数│
		├────┼────┼────┼──────┤
		│    1   │    0   │    0   │    3.9KHz  │
		├────┼────┼────┼──────┤
		│    1   │    0   │    1   │    5.2KHz  │
		├────┼────┼────┼──────┤
		│    0   │    0   │    0   │    7.8KHz  │
		├────┼────┼────┼──────┤
		│    0   │    0   │    1   │   10.4KHz  │
		├────┼────┼────┼──────┤
		│    0   │    1   │    0   │   15.6KHz  │
		├────┼────┼────┼──────┤
		│    1   │    1   │    1   │   20.8KHz  │
		├────┼────┼────┼──────┤
		│    1   │    1   │    0   │   31.2KHz  │
		└────┴────┴────┴──────┘


（２）０４０ｔｕｒｂｏのコピーバックモード対応

　一応コードを埋め込んだだけで、動作確認を全く行っていません。


●参考文献

　１）瀧　康史：「内蔵ＡＤ ＰＣＭ高音質化計画」
　　　　　　　　　ソフトバンク株式会社　Ｏｈ！Ｘ　１９９４年８月号

　２）ＢＥＥＰｓ：「Ｘ６８／０４０ｔｕｒｂｏ」ソフトバンク株式会社

　３）桑野雅彦：「Ｏｕｔｓｉｄｅ　Ｘ６８０００」ソフトバンク株式会社

　４）桑野雅彦：「Ｘ６８０３０　Ｉｎｓｉｄｅ／Ｏｕｔ」ソフトバンク株式会社

　５）「'８８最新ＴＴＬ ＩＣ規格表」ＣＱ出版社

（ＥＯＦ）
