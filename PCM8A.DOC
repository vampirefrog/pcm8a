┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃									┃
┃	リアルタイム　ＡＤＰＣＭ多重再生ドライバー　『ＰＣＭ８Ａ』	┃
┃									┃
┃		version 0.43			philly 1993,1994	┃
┃									┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

　名前からすぐにわかると思いますが、PCM8.X (c)H.Etoh （以下 PCM8.X と略し

　ます）相当のプログラムです

　基本的な機能・使い方は PCM8.X と同じです


▲基本機能

１）Ｘ６８０ｘ０のＡＤＰＣＭ出力を、複数の出力がリアルタイムでできるように

　　する常駐型ドライバーです

２）１０ＭＨｚの機種でも８チャンネル同時出力が可能です

３）チャンネル毎に再生周波数および音量を指定することができます


▲ PCM8.X（ version 0.48/0.48a/0.48b ）とは以下の差異があります

１）少し高速になっています

　　欠点：多少音質が低下しています（高速化の弊害です）

２）ＡＤＰＣＭ出力は音量変換しても処理速度は変わりません

　　欠点：16/8ビットＰＣＭは音量変換によって処理速度が低下します

３）音量の可変範囲とステップを拡張しました

　　（ -16dB 〜 +14dB , 2dB/step → -53dB 〜 +26dB , 約0.8dB/step ）

４）デバイスドライバとして登録可能です

５）欠点：プログラムサイズ・常駐サイズが PCM8.X より相当大きくなっています

	　（プログラムサイズ 55K バイト , 常駐サイズ 350K バイト）


▲使用方法

　基本的に PCM8.X と同じになっていますが、機能を一部追加してあります。

　コマンドラインからは PCM8A [ｽｲｯﾁ] で組み込まれます。

　また、CONFIG.SYS からは DEVICE= の指定で組み込むことができ、デバイス名は

　PCM (または @PCM) となります。

　スイッチは以下の通りです。

	ON	：多重再生許可（デフォルト）

	OFF	：多重再生禁止

	FNC	：trap #2 のファンクションコールのみ多重再生可能
		　IOCSは単音再生となります

	CLR	：全チャンネルを初期化する（新規追加）
		　動作モードは変わらない

	-R	：常駐解除
		　他のアプリケーションにより解除が禁止されている場合は解除
		　できません

	-D[num]	：動作状態表示モード設定
		　num =	　0	：ＯＦＦ（デフォルト）
			　1	：ＯＮ
			省略	：ＯＦＦ／ＯＮ 状態反転

	-V[num]	：音量可変モード設定
		　num =	　0	：音量固定
			　1	：音量可変（デフォルト）
			省略	：固定／可変 状態反転
		　音量固定にすると、それ以降の出力は原音固定となります

	-Inum	：IOCSで使用可能なチャンネルの最大数
		　num = 0 〜 8	（デフォルト = 8 ）
		　0 に設定すると、IOCS出力が禁止されます

	-N	：CONFIG.SYS からの組み込みでこれを指定すると、デバイス名
		　を @PCM とする（新規追加）

　スイッチに誤りがある場合、ヘルプを表示します。

　なお、PCM8A.X が常駐している状態で、PCM8 OFF や PCM8 -R のような、PCM8.X

　による動作中のモード変更や常駐解除の制御が可能になっています。

　（ PCM8.X と PCM8A.X で、制御方法が共通のため、逆も可能です）


▲ PCM8.X に対する、ファンクションコールの主な変更点／追加機能

	変更点／追加機能の詳細については PCM8ATEC.DOC を参照してください。

１）機能コード $000x , $001x , $002x の D1.L の ビット 23〜16	：機能追加

	・ $FF,$00〜$0F 以外に $40〜$A0 が指定可能

	・ $80 が原音、$40 に近づくに従い音が小さくなり、$A0 に近づくに従

	　 い音が大きくなる

２）機能コード $00Ax （アクセスアドレス問い合わせ）		：新規追加

３）機能コード $00Bx （チャンネル一時停止）			：新規追加

４）機能コード $00Cx （チャンネル一時停止解除）			：新規追加

５）機能コード $0103 （ＰＣＭ８Ａ停止）				：新規追加

６）機能コード $0104 （ＰＣＭ８Ａ動作）				：新規追加

７）機能コード $01F9 （ＰＣＭ８Ａシステム情報問い合わせ）	：新規追加

８）機能コード $01FA （動作モード問い合わせ／変更）		：新規追加

９）機能コード $FFF0 （ＰＣＭ８Ａ割り込みフラグチェック）	：新規追加

10）機能コード $FFF1 （ＰＣＭ８Ａ内部初期化)			：新規追加

11）機能コード $FFFD （使用ベクタ問い合わせ）			：新規追加

	その他、細かい部分にも仕様の差異がありますが、割愛します。

	また、PCM8.X 本体の動作と、テクニカルマニュアルの記載に相違がある

	部分は、できるだけテクニカルマニュアルの仕様を優先しました。


▲注意事項／その他

１）処理簡略化により多少の演算誤差を発生してしまい、その結果として、音質に

　　変化が現れたり、定位の変化時にノイズが発生しやすくなったり、大音量時に

　　歪みが発生しやすくなったりと、様々な副作用が発生しています。

　　音質を重視する場合、PCM8.X を使用してください。


２）デバイスドライバとして組み込みを行い、-R で組み込みを一旦解除し、その

　　後再び組み込んだ場合には、動作モードは組み込み解除前の状態を保ったまま

　　組み込まれます。

　　この動作はコマンドラインからの組み込みと違ってくるので注意が必要です。


３）Ｘ６８０３０で CONFIG.SYS からの組み込みを行う場合、本プログラムの能力

　　を十分に発揮させるために、本プログラムの先頭アドレスを、４バイト境界の

　　位置にしておくことをお勧めします。

　　これは、本プログラム内部のワークエリア及びテーブル類が、４バイト境界を

　　基準に配置してあるためです。

　　（FILES= の値を変更することで調整できると思います）

　　コマンドラインからの常駐では、先頭アドレスは自動的に４バイト境界となる

　　ため、配慮は不要です。


４）ラスター割り込みへの配慮もある程度行いましたが、１０ＭＨｚのマシンでは

　　本プログラムを使用しながら、ラスター割り込みを使用するのは無理があるの

　　で、できるだけ併用は避けてください。


５）プログラム作成の際にはバグ混入の無いよう心掛けてはいますが、本プログラ

　　ムの使用に起因する、損害に関する責任は負いかねます。

　　特に本プログラムの動作はハードウェアに密着したものであるため、使用者の

　　環境に大きく左右され、作者の環境下では絶対に発生しない不都合や、ソフト

　　ウェア的に回避できない不都合が発生する可能性がありますので、予め御了承

　　願います。

　　ちなみに、本プログラムは X68000(無印) + 増設3M 及び X68030 + 増設8M で

　　開発と動作確認を行っています。


６）本プログラムとソースリスト及びドキュメント類はフリーウェアとします。

　　配布に際しては、本ドキュメントとテクニカルマニュアルを必ず添付すること

　　以外に制限はありません。不当な利益を上げる目的でなければ、営利を伴った

　　配布も許可します。配布時の連絡も不要です。

　　なお、ゲーム等への組み込みでは、ドキュメント類の添付は不要です。

　　改変は自由ですが、改変した内容はドキュメント等に明記し、タイトルを変更

　　するなどの手段で、改変したプログラムであることを、第三者が容易に判別で

　　きるようにしておいてください。


▲以下のツールをプログラムの作成（とデバッグ）に使用しました

　　X68k High-speed Assembler v2.55 Copyright 1990,91,92 by Y.Nakamura

　　X68k SILK Hi-Speed Linker v2.27 Copyright 1989-92 SALT

　　X680x0 Screen Editor (ED.R) ver 0.99XB Copyright 1991,92,93 by S.Ueda

　　ソースコードジェネレータ for X68000 version 2.01β
					Copyright (C) 1989,1990 K.Abe

　　MEMORYSCOPE for X68000 version 0.03
　　Copyright 1990,1991 Tsune Art Studio/K.Tsuneyoshi(Tsune)

　　<<Street Fighter II'>> SF2.X patch  version 1.03  (C)1993 E.Watanabe

　　<<GAROU DENSETSU 2>> GARO2.X patch  version 1.13  (C)1993,94 E.Watanabe

　　その他 SHARP/Hudson 開発のプログラムの数々


　また、本プログラムの動作確認にあたり、数種のＦＭ音源ドライバとそのサポー

トツール、及び数多くの音楽データを使用させていただきました。

　（いずれも、たまたま手元にあったために使用したものであり、かなり古いバー

　　ジョンのものもあります）

　　X68k MXDRV music driver version 2.06+16 Rel.1
			(c)1988-91 milk.,K.MAEKAWA, Missy.M, Yatsube

　　X68k MDX AUDIO DRIVER version 2.00a HSX/2.06+15/16 (c)1991,92 Konoa.

　　Z-MUSIC UNIVERSAL VERSION 1.51 (C) 1991,1992,1993 ZENJI SOFT
　　Z-MUSIC UNIVERSAL VERSION 2.00 (C) 1991,1992,1993 ZENJI SOFT

　　ＭＺＰ [ Multi music data player for Z-MUSIC ]  Ver. 1.12b
							(C)1991-93 NOVA
　　MXtoZ [ MDX data converter for Z-MUSIC ]  Ver. 0.43a  (C)1991-93 NOVA

　　X68k multi music status display MMDSP.r v0.22 (c)1991,92 Miahmie, Gao

　　SXZ-Conductor v2.48 Copyright 1991-93 けんと

　　多数のＭＤＸファイル

　　電脳倶楽部掲載のＺＭＳファイル


　作成者の方々にこの場を借りてお礼申し上げます。


▲参考文献及び参考としたプログラム

１）PCM8.X	X68k PCM8 polyphonic PCM driver v0.48 (c)1991,92 H.Etoh
		X68k PCM8 polyphonic PCM driver v0.48a (c)1991,92 H.Etoh
		X68k PCM8 polyphonic PCM driver v0.48b (c)1991-93 H.Etoh
		及び　ドキュメント／テクニカルマニュアル

２）江藤　啓：「マルチチャンネルＡＤＰＣＭドライバ　ＰＣＭ８」
		ソフトバンク株式会社　Ｏｈ！Ｘ　１９９２年６月号

３）ADPCM4.X	M3system/X68000 multi voice ADPCM driver
		Copyright (c) 1993 by S.P.S

４）日立データブック１９８９
　　「６８００，６８０００シリーズ　マイクロプロセッサ・周辺ＬＳＩ」
　　　ＨＤ６３４５０／ＨＤ６８４５０　ＤＭＡＣ

５）宍倉幸則：「６８０００プログラマーズ・ハンドブック」，技術評論社

６）ＰＯＰＣＯＭ編集部・編：「Ｘ６８０００データブック」，小学館


▲最後に

　本プログラムの作成に当たり参考及び目標となった PCM8.X は、X680x0 のユー

　ザーで知らない人はいないであろう優れたソフトウェアであり、今後さらなる発

　展を遂げることを切望するとともに、ここに故人の多大なる御功績を偲び、心か

　ら御冥福申し上げます。


（ＥＯＦ）
