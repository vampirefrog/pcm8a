┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃									┃
┃	リアルタイム　ＡＤＰＣＭ多重再生ドライバー　『ＰＣＭ８Ａ』	┃
┃									┃
┃		version 0.51			philly 1993-1995	┃
┃									┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

　　PCM8.X (c)H.Etoh （以下 PCM8 と略します）相当のプログラムです


▲基本機能

　１）Ｘ６８０ｘ０のＡＤＰＣＭ出力を、複数の出力がリアルタイムでできるよう
　　　にする常駐型ドライバーです

　２）１０ＭＨｚの機種でも８チャンネル同時出力が可能です
　　　（モードの設定によっては、８チャンネルを出力できないことがあります）

　３）チャンネル毎に再生周波数および音量を指定することができます


▲ PCM8（ version 0.48/0.48a/0.48b ）とは以下の差異があります

　１）少し高速になっています
　　　欠点：多少音質が低下しています（高速化の弊害です）

　２）ＡＤＰＣＭ出力は音量変換しても処理速度は変わりません
　　　（16/8ビットＰＣＭは音量変換を行うと処理速度が低下します）

　３）音量の可変範囲を広げ、音量の設定数を増やしました
　　　（可変範囲　： -53dB 〜 +26dB , 97段階 ）

　４）ＡＤＰＣＭ及び16/8ビットＰＣＭの出力周波数範囲を拡張しました
　　　（ 20.8KHz , 31.2KHz が使用できます）

　５）チャンネル数／処理バイト数／音量の可変範囲が変更できます
　　　（常駐時に指定すると、常駐サイズが変化します）

　６）デバイスドライバとして登録可能です
　　　（デバイスドライバとして登録されていても常駐解除できます）

　７）欠点：プログラムサイズ・常駐サイズが PCM8 より大きくなっています
　　　（プログラムサイズ 36K バイト , 常駐サイズ 220K 〜 340K バイト）


▲使用方法

　基本的に PCM8 と同じになっていますが、機能を一部追加しています。

　コマンドラインからは PCM8A [ｽｲｯﾁ] で組み込まれます。

　また、CONFIG.SYS からは DEVICE= の指定で組み込むことができ、デバイス名は
PCM (または @PCM) となります。

　スイッチは以下の通りです。

	ON	：多重再生許可（デフォルト）

	OFF	：多重再生禁止

	FNC	：trap #2 のファンクションコールのみ多重再生可能
		　IOCSは単音再生となります

	CLR	：全チャンネルを初期化します
		　動作モードの設定は変わりません

	-R	：常駐解除
		　他のアプリケーションにより解除が禁止されている場合は解除
		　できません
		　CONFIG.SYS 中で指定すると、PCM8A がメモリ上に残ったまま
		　常駐が解除された状態になり、次に PCM8A を常駐させる時に
		　メモリ上に残っていた PCM8A が有効になります

	-D[num]	：動作状態表示モード設定
		　num =	　0	：ＯＦＦ（デフォルト）
			　1	：ＯＮ
			省略	：ＯＦＦ／ＯＮ 状態反転

	-V[num]	：音量可変モード設定
		　num =	　0	：音量固定
			　1	：音量可変（デフォルト）
			省略	：固定／可変 状態反転
		　音量固定にすると、それ以降の出力は原音固定となります

	-Inum	：IOCSで使用可能なチャンネルの最大数
		　num = 0 〜 8	（デフォルト = 8 ）
		　0 に設定すると、IOCS出力が禁止されます

	-N	：デバイスドライバ組み込み時に指定すると、デバイス名を
		　 @PCM にして組み込みます
		　コマンドラインからの常駐時に指定しても無視します

	-S[num1],[num2],[num3],[num4]
		：システムの状態設定
		　num1 ：最大チャンネル数（ 1 〜 16 :デフォルト= 8 ）
		　num2 ：処理バイト数/12 （ 1 〜 12 :デフォルト= 4 ）
		　num3 ：音量の最小値（ 0〜 8 , $40〜$80 :デフォルト= $40 ）
		　num4 ：音量の最大値（ 8〜15 , $80〜$A0 :デフォルト= $A0 ）
		　常駐時に指定すると、常駐サイズが変化します

　スイッチに誤りがある場合、ヘルプを表示します。

　なお、PCM8A が常駐している状態で、PCM8 OFF や PCM8 -R のような、PCM8 に
よる動作中のモード変更や常駐解除の制御が可能になっています。
　（ PCM8 と PCM8A で、制御方法が共通のため、逆も可能です）


▲ PCM8 に対する、ファンクションコールの主な変更点／追加機能

	変更点／追加機能の詳細については PCM8ATEC.DOC を参照してください。

　１）機能コード $000x , $001x , $002x の D1.L の ビット 23〜16	：機能追加
	・ $FF,$00〜$0F 以外に $40〜$A0 が指定可能
	・ $80 が原音、$40 に近づくに従い音が小さくなり、$A0 に近づくに従
	　 い音が大きくなる

　２）機能コード $00Ax （アクセスアドレス問い合わせ）		：新規追加

　３）機能コード $00Bx （チャンネル一時停止）			：新規追加

　４）機能コード $00Cx （チャンネル一時停止解除）		：新規追加

　５）機能コード $0103 （ＰＣＭ８Ａ停止）			：新規追加

　６）機能コード $0104 （ＰＣＭ８Ａ動作）			：新規追加

　７）機能コード $01F8 （ＰＣＭ８Ａシステム情報設定）		：新規追加

　８）機能コード $01F9 （ＰＣＭ８Ａシステム情報問い合わせ）	：新規追加

　９）機能コード $01FA （動作モード問い合わせ／変更）		：新規追加

　10）機能コード $FFF0 （ＰＣＭ８Ａ割り込みフラグチェック）	：新規追加

　11）機能コード $FFF1 （ＰＣＭ８Ａ内部初期化)			：新規追加

　12）機能コード $FFFD （使用ベクタ問い合わせ）			：新規追加

	その他、細かい部分にも仕様の差異がありますが、割愛します。


▲注意事項／その他

　１）　処理簡略化により多少の演算誤差を発生してしまい、音質の低下、定位の
　　　変化時のノイズ発生、大音量出力時の歪みの増加など、様々な副作用が発生
　　　しています。

　　　　音質を重視する場合、PCM8 を使用してください。


　２）　デバイスドライバとして組み込んだ場合、-R で組み込みを解除しても、
　　　メモリ上にはＰＣＭ８Ａの本体が残っています。

　　　　そして、ＰＣＭ８Ａを再び組み込む場合、デバイスドライバ名（ PCM 又
　　　は @PCM ）を元に、デバイスドライバとして組み込まれたＰＣＭ８Ａを、メ
　　　モリ上から探して有効にします。

　　　　なお、この時の動作モードは組み込み解除前の状態が保持されています。


　３）　ＰＣＭ８Ａはバージョン０．５０以降、６８０３０の命令キャッシュの機
　　　能を有効に利用できるようになりましたが、逆に６８０００を搭載した機種
　　　では、性能が低下するようになりました。

　　　　そのため、６８０００の搭載機種で、特に処理速度を問題にする場合、
　　　バージョン０．４ｘを使用することをお勧めします。


　４）　“−Ｓ”オプションは常駐時に指定するだけでなく、常駐後にも指定でき
　　　ますが、常駐時に指定した値よりワークエリアが広く必要になる指定を、常
　　　駐後に指定することはできません。

　　　　ワークエリアが広く必要になるのは以下の場合です。
　　　　　(1) 全チャンネル数を増やす場合
　　　　　(2) 処理バイト数を増やす場合
　　　　　(3) 音量の最小値を小さくした場合
　　　　　(4) 音量の最大値を大きくした場合

　　　　なお、“−Ｓ”オプションを指定せずに常駐させた場合は特別に、ワーク
　　　エリアが確保されるサイズとデフォルトの設定とが異なり、以下のようにな
　　　ります。
　　　　　(1) 全チャンネル数=  16（デフォルト=   8 ）
　　　　　(2) 処理バイト数  = 144（デフォルト=  48 ）
　　　　　(3) 音量の最小値  = $40（デフォルト= $40 ）
　　　　　(4) 音量の最大値  = $A0（デフォルト= $A0 ）


　５）　ラスター割り込みへの配慮も出来る限り行いましたが、１０ＭＨｚの機種
　　　において、ＰＣＭ８Ａとラスター割り込みを併用すると、ＣＰＵに負担がか
　　　かり過ぎ、ＰＣＭ８Ａの動作が不安定になったり、他のプログラムの動作に
　　　悪影響を及ぼす恐れがあるので、できるだけ併用は避けてください。


　６）　プログラム作成の際にはバグ混入の無いよう心掛けていますが、本プログ
　　　ラムの使用に起因する、損害に関する責任は負いかねます。

　　　　特に本プログラムの動作はハードウェアに密着しているため、使用者の環
　　　境に大きく左右され、作者の環境下では絶対に発生しない不都合や、ソフト
　　　ウェア的に回避できない不都合が発生する可能性があることを、予め御了承
　　　願います。

　　　　ちなみに、本プログラムは X68000(無印)+増設3M 及び X68030+増設8M で
　　　開発と動作確認を行っています。


　７）　本プログラムとソースリスト及びドキュメントはフリーウェアとします。

　　　　配布に際しては、本ドキュメントとテクニカルマニュアルを必ず添付する
　　　事以外に制限はありません。不当な利益を得る目的でなければ、営利を伴っ
　　　た配布も許可します。配布時の連絡も不要です。

　　　　なお、ゲーム等の組み込みに伴う配布の場合、ドキュメントの添付は強制
　　　しません。

　　　　基本的に改変は自由ですが、改変した内容はドキュメント等に明記し、タ
　　　イトル変更等の手段で、改変したプログラムであることを、利用者が容易に
　　　判別できるようにしておいてください。

　　　　但し、利用者に不当な利益を及ぼす改変は禁止します。


▲以下のツールをプログラムの作成（とデバッグ）に使用しました

　　X68k High-speed Assembler v2.55 Copyright 1990,91,92 by Y.Nakamura
　　X68k High-speed Assembler v3.08 Copyright 1990-94 by Y.Nakamura

　　X68k SILK Hi-Speed Linker v2.27 Copyright 1989-92 SALT
　　X68k SILK Hi-Speed Linker v3.01 Copyright 1989-94 SALT

　　X680x0 Screen Editor (ED.R) ver 0.99XI Copyright 1991,92,93 by S.Ueda

　　ソースコードジェネレータ for X68000 version 2.01β
					Copyright (C) 1989,1990 K.Abe

　　MEMORYSCOPE for X68000 version 0.03
　　Copyright 1990,1991 Tsune Art Studio/K.Tsuneyoshi(Tsune)

　　<<Street Fighter II'>> SF2.X patch  version 1.03  (C)1993 E.Watanabe

　　<<GAROU DENSETSU 2>> GARO2.X patch  version 1.13  (C)1993,94 E.Watanabe

　　その他 SHARP/Hudson 開発のプログラムの数々


　また、本プログラムの動作確認にあたり、数種のＦＭ音源ドライバとそのサポー
トツール、及び数多くの音楽データを使用させていただきました。

　（いずれも、たまたま手元にあったために使用したものであり、かなり古いバー
　　ジョンのものもあります）

　　X68k MXDRV music driver version 2.06+16 Rel.1
			(c)1988-91 milk.,K.MAEKAWA, Missy.M, Yatsube

　　X68k MDX AUDIO DRIVER version 2.00a HSX/2.06+15/16 (c)1991,92 Konoa.

　　Z-MUSIC UNIVERSAL VERSION 1.52 (C) 1991,1992,1993 ZENJI SOFT
　　Z-MUSIC UNIVERSAL VERSION 2.02 (C) 1991,1992,1993 ZENJI SOFT

　　ＭＺＰ [ Multi music data player for Z-MUSIC ]  Ver. 1.12b
							(C)1991-93 NOVA
　　MXtoZ [ MDX data converter for Z-MUSIC ]  Ver. 0.43a  (C)1991-93 NOVA

　　X68k multi music status display MMDSP.r v0.22 (c)1991,92 Miahmie, Gao

　　SXZC v2.48 Copyright 1991-93 けんと

　　多数のＭＤＸファイル

　　電脳倶楽部掲載のＺＭＳファイル


　作成者の方々にこの場を借りてお礼申し上げます。


▲参考文献及び参考としたプログラム

　１）PCM8.X	X68k PCM8 polyphonic PCM driver v0.48 (c)1991,92 H.Etoh
		X68k PCM8 polyphonic PCM driver v0.48a (c)1991,92 H.Etoh
		X68k PCM8 polyphonic PCM driver v0.48b (c)1991-93 H.Etoh
		及び　ドキュメント／テクニカルマニュアル

　２）江藤　啓：「マルチチャンネルＡＤＰＣＭドライバ　ＰＣＭ８」
		　ソフトバンク株式会社　Ｏｈ！Ｘ　１９９２年６月号

　３）ADPCM4.X	M3system/X68000 multi voice ADPCM driver
		Copyright (c) 1993 by S.P.S

　４）日立データブック１９８９
　　　「６８００，６８０００シリーズ　マイクロプロセッサ・周辺ＬＳＩ」
　　　　ＨＤ６３４５０／ＨＤ６８４５０　ＤＭＡＣ

　５）宍倉幸則：「６８０００プログラマーズ・ハンドブック」，技術評論社

　６）ＰＯＰＣＯＭ編集部・編：「Ｘ６８０００データブック」，小学館


▲最後に

　　本プログラムの作成に当たり参考及び目標となった PCM8.X は、Ｘ６８０ｘ０
　ユーザー必携の優れたソフトウェアであり、今後さらなる発展を遂げることを切
　に願うとともに、ここに故人の多大なる御功績を偲び、心から御冥福申し上げま
　す。


（ＥＯＦ）
