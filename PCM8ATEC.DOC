┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃									┃
┃	リアルタイム　ＡＤＰＣＭ多重再生ドライバー　『ＰＣＭ８Ａ』	┃
┃									┃
┃	version 0.43	テクニカルマニュアル				┃
┃						philly 1993,1994	┃
┃									┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
１．ＰＣＭデータ形式

	ＰＣＭ８Ａが取り扱える PCM データの形式は、以下の３種類です。

	（１）ＡＤＰＣＭ	（周波数は５段階）

		X680x0 で標準的に使われているＰＣＭデータです。

	（２）１６ビットＰＣＭ	（周波数は 15.6 KHz 固定）

		Ｃ言語の signed short に相当します。
		この形式のデータは、常に偶数番地から始まり、データの長さも
		偶数バイトが指定されていなくてはなりません。

	（３）８ビットＰＣＭ	（周波数は 15.6 KHz 固定）

		Ｃ言語の signed char に相当します。
		出力時は、８ビットのデータの符号を拡張して１６ビットとし、
		合成を行います。


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
２．ＰＣＭ８Ａコール方法

	以下の２種類の方法をサポートしています。

	（１）trap #2 命令を使用したファンクションコール

	（２）IOCS コールによる簡易使用


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
３．ＰＣＭ８Ａファンクション一覧

	trap #2 命令を使用したファンクションコールの詳細を示します。

	D0.W に機能コードを設定し、他のレジスタに適切な値を設定した後、
	 trap #2 命令を実行してください。

	戻り値は D0.L に設定され、他のデータ／アドレスレジスタは全て保存
	されます。

	以下の内容は、PCM8A version 0.43 の時点のものです。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　１：通常出力						機能コード $000x
─────────────────────────────────────

機能：	単一メモリ領域のデータを出力する

呼出：	D0.W	$0000 + チャンネル番号（0〜7）

	D1.L	音量／周波数／定位の指定

		ビット
		23〜16	：音量指定（ $FF , $00〜$0F , $40〜$A0 ）

			　$FF	　　：前の値を保持
			　$00〜$0F　：原音量は $08
				　　　（ -16dB〜+14dB ,１ステップ≒ 2dB）
			　$40〜$A0　：原音量は $80
				　　　（ -53dB〜+26dB ,１ステップ≒0.8dB）
				　　　詳細は『７．音量変換の詳細について』
				　　　を参照すること
			　※単音再生モードでは常に原音量で出力する

		15〜 8	：周波数及びデータ形式の指定（ $FF , $00〜$06 ）

			　$FF	　　：前の値を保持
			　$00〜$04　：ＡＤＰＣＭ形式
					値　　再生周波数
					$00　： 3.9 KHz
					$01　： 5.2 KHz
					$02　： 7.8 KHz
					$03　：10.4 KHz
					$04　：15.6 KHz
			　$05	　　：16ビットＰＣＭ形式
					（再生周波数 15.6KHz）
			　$06	　　： 8ビットＰＣＭ形式
					（再生周波数 15.6KHz）
			　※単音再生モードでは 16/8ビットＰＣＭ形式は指定
			　　できない

		 7〜 0	：定位指定（ $FF , $00〜$03 ）

			　$FF	　　：前の値を保持
			　$00	　　：再生停止
					音量／周波数は変更されるが
					定位は変更されない
			　$01	　　：左出力
			　$02	　　：右出力
			　$03	　　：左右（中央）出力
			　※この指定は全チャンネルに共通であり、最後に指定
			　　された $00 以外の値が有効になる

		他のビットは無効

	D2.L	出力するデータのバイト数

		＜ 0　　：データ長問い合わせ（機能コード $008x と同機能）
		＝ 0　　：チャンネル動作停止
			　（音量／周波数／定位は変更されない）
		16ビットＰＣＭ出力時には偶数を指定すること

	A1.L	データ先頭アドレス

		16ビットＰＣＭ出力時には偶数アドレスを指定すること

戻値：	D0.L	（ D2.L ＜ 0 の場合、機能コード $008x を参照のこと）
		＝ 0	：正常終了


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　２：アレイチェーン出力				機能コード $001x
─────────────────────────────────────

機能：	アレイチェーンテーブルによって、間接的に指定された複数のメモリ領域
	のデータを出力する

呼出：	D0.W	$0010 + チャンネル番号（0〜7）

	D1.L	音量／周波数／定位の指定

		通常出力（$000x）の指定に同じ

	D2.L	アレイチェーンデータの個数

		＜ 0　　：データ長問い合わせ（機能コード $008x と同機能）
		＝ 0　　：チャンネル動作停止
			　（音量／周波数／定位は変更されない）
		※単音再生モードでは、最大 65535（$FFFF） まで

	A1.L	アレイチェーンテーブル先頭アドレス

		必ず偶数アドレスを指定すること
		アレイチェーンテーブルについての説明は省略

戻値：	D0.L	（ D2.L ＜ 0 の場合、機能コード $008x を参照のこと）
		＝ 0	：正常終了


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　３：リンクアレイチェーン出力				機能コード $002x
─────────────────────────────────────

機能：	リンクアレイチェーンテーブルによって、間接的に指定された複数のメモ
	リ領域のデータを出力する

呼出：	D0.W	$0020 + チャンネル番号（0〜7）

	D1.L	音量／周波数／定位の指定

		通常出力（$000x）の指定に同じ

	A1.L	リンクアレイチェーンテーブル先頭アドレス

		必ず偶数アドレスを指定すること
		リンクアレイチェーンテーブルについての説明は省略

戻値：	D0.L	＝ 0	：正常終了


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　４：動作モード変更					機能コード $007x
─────────────────────────────────────

機能：	動作中のチャンネルの音量／周波数／定位を変更する

呼出：	D0.W	$0070 + チャンネル番号（0〜7）

	D1.L	音量／周波数／定位の指定

		通常出力（$000x）の指定に同じ

戻値：	D0.L	＝ 0	：正常終了


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　５：データ長問い合わせ				機能コード $008x
─────────────────────────────────────

機能：	動作中のチャンネルの残りデータ長を取得する

呼出：	D0.W	$0080 + チャンネル番号（0〜7）

戻値：	D0.L	＝ 0	：チャンネルは停止中
		＞ 0	：残りのデータのバイト数
			　（多重再生モードで、通常出力中）
		＝ -1	：アレイチェーン出力中
		＝ -2	：リンクアレイチェーン出力中
		＝ -3	：単音再生モードで出力中


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　６：動作モード問い合わせ				機能コード $009x
─────────────────────────────────────

機能：	動作中のチャンネルの音量／周波数／定位を取得する

呼出：	D0.W	$0090 + チャンネル番号（0〜7）

戻値：	D0.L	＞ 0	：音量／周波数／定位
			　通常出力（$000x）を参照のこと
			　定位は常に $01〜$03 の値となり、ビット 31〜24 は
			　常に 0 となる


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　７：アクセスアドレス問い合わせ			機能コード $00Ax
─────────────────────────────────────

機能：	動作中のチャンネルのアドレスポインタの情報を取得する

呼出：	D0.W	$00A0 + チャンネル番号（0〜7）

戻値：	D0.L	≧ 0	：ＡＤＰＣＭ／ＰＣＭデータのアドレスポインタ情報


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　８：チャンネル一時停止				機能コード $00Bx
─────────────────────────────────────

機能：	チャンネルの動作を一時停止する

	この処理は $000x , $001x のコールで、 D2.L ＝ 0 を指定した場合と同
	じになる

呼出：	D0.W	$00B0 + チャンネル番号（0〜7）

戻値：	D0.L	＝ 0	：正常終了

	一時停止（$0101）とは別に扱われ、どちらかのコールで一時停止が指定
	されれば、チャンネルの動作は一時停止状態に入る


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
　９：チャンネル一時停止解除				機能コード $00Cx
─────────────────────────────────────

機能：	チャンネルの一時停止状態を解除する

呼出：	D0.W	$00C0 + チャンネル番号（0〜7）

戻値：	D0.L	＝ 0	：正常終了

	一時停止解除（$0102）とは別に扱われ、両方のコールで一時停止が解除
	された場合のみ、チャンネルの一時停止状態は解除される
	動作が打ち切られた後の継続出力も可能
	過負荷状態になり、一時停止状態になった出力を、このコールで継続出力
	させることができる
	ＰＣＭ８Ａが初期化された後は無効


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１０：終了						機能コード $0100
─────────────────────────────────────

機能：	全チャンネルのチェイン動作を解除し、現在出力中のデータブロックの出
	力が完了次第、チャンネルの動作を停止する

	一時停止中の場合は即座に全チャンネルの動作を打ち切る

呼出：	D0.W	$0100

戻値：	D0.L	＝ 0	：正常終了

	即時終了ではない点に注意すること
	即時に完全に終了させたい場合は、一時停止（$0101）の後、本コールを
	実行すること
	単音出力中は、一時停止（$0101）実行後に本コールを実行することによ
	り、即時終了させることができる


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１１：一時停止						機能コード $0101
─────────────────────────────────────

機能：	全チャンネルの出力を即座に停止し、一時停止状態に入る

	一時停止状態でチャンネル出力または終了を行うと、全チャンネルの動作
	が打ち切られる

呼出：	D0.W	$0101

戻値：	D0.L	＝ 0	：正常終了

	単音出力中は一時停止しないが、終了（$0100）と組み合わせることで、
	即時終了させることができる


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１２：一時停止解除					機能コード $0102
─────────────────────────────────────

機能：	一時停止状態を解除する

	動作が打ち切られた後は無効

呼出：	D0.W	$0102

戻値：	D0.L	＝ 0	：正常終了

	単音出力中は、このコールは無視される


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１３：ＰＣＭ８Ａ停止					機能コード $0103
─────────────────────────────────────

機能：	ＰＣＭ８ＡによるＡＤＰＣＭの管理を停止する

呼出：	D0.W	$0103

戻値：	D0.L	＝ 0	：正常終了

	この命令が実行されると、ＡＤＰＣＭ及びＰＣＭ８Ａは初期化され、待機
	状態に入る
	この命令の実行で、ノイズが出力されることがある
	待機状態で出力を行うと、ＡＤＰＣＭはＰＣＭ８Ａによって管理される状
	態に戻る


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１４：ＰＣＭ８Ａ動作					機能コード $0104
─────────────────────────────────────

機能：	ＡＤＰＣＭの管理をＰＣＭ８Ａに渡す

呼出：	D0.W	$0104

戻値：	D0.L	＝ 0	：正常終了

	この命令が実行されると、ＡＤＰＣＭ及びＰＣＭ８Ａは初期化され、動作
	状態に入る
	この命令の実行で、ノイズが出力されることがある


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１５：ＰＣＭ８Ａシステム情報問い合わせ			機能コード $01F9
─────────────────────────────────────

機能：	ＰＣＭ８Ａシステム情報の取得

呼出：	D0.W	$01F9

戻値：	D0.L	システム情報

			ビット
			31〜16	:割り込み１回の処理バイト数（$0030 固定）
			15〜 8	:音量設定最大値（$A0 固定）
			 7〜 0	:音量設定最小値（$40 固定）


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１６：動作モード問い合わせ／変更			機能コード $01FA
─────────────────────────────────────

機能：	動作モード情報の取得／設定

呼出：	D0.W	$01FA

	D1.L	＜ 0	：動作モード取得
		≧ 0　　：動作モード設定

			ビット
			27	：動作表示モード反転
			26	：音量可変モード反転
			23〜16	：IOCSで使用できるチャンネル数
				　（ $FF , $00〜$08 ）
					$FF	　：前の値を保持
					$00	　：IOCS出力禁止
					$01〜$08　：IOCS出力チャンネル数
			ビット 27,26 はモード反転時に 1 を設定する
			ビット 31〜28 は 0 を設定しておくこと
			他のビットは無効

戻値：	D0.L	≧ 0	：（変更前の）動作モード情報

			ビット
			27	：動作表示モード
				　　0	：動作表示無し
				　　1	：動作表示有り
			26	：音量可変モード（trap #2 による設定状態）
			25	：	〃
					（コマンドラインによる設定状態）
				　　0	：音量固定
				　　1	：音量可変
				　※音量可変モードの設定はコマンドラインの
				　　指定とは別に扱われ、両方で音量可変を指
				　　定した場合に限り、音量は可変となる
			24	：組み込みモード
				　　0	：コマンドラインからの組み込み
				　　1	：デバイスドライバ組み込み
			23〜16	：IOCSで使用できるチャンネル数
				　　$00		：IOCS出力禁止
				　　$00以外	：IOCS同時出力チャンネル数
			15〜 8	：全チャンネル数（$08 固定）
			 7〜 0	：動作中チャンネル数　（$00〜$08）
				　単音出力モードでは常に $00 となる


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１７：ＭＰＵ・ＭＦＰマスク設定				機能コード $01FB
─────────────────────────────────────

機能：	ＰＣＭ８Ａ割込中のＭＰＵ／ＭＦＰ割込マスクを設定する

呼出：	D0.W	$01FB

	D1.W	割り込みレベル／マスクデータ指定

		＜ 0	割り込みレベル／マスク情報取得
		≧ 0	割り込みレベル／マスク情報設定

			ビット
			18〜16	：ＭＰＵ割り込みレベル（3〜7）
			15〜 8	：ＭＦＰ割り込みマスクＡ（IMRA）
			 7〜 0	：ＭＦＰ割り込みマスクＢ（IMRB）
			ビット15〜0の意味は、0 で割り込みマスク、1 で割り
			込み開始前と同じ状態、になる

戻値：	D0.L	≧ 0	：（変更前の）割り込みレベル／マスク値
			　ビット 31〜19 は 0 となる

	割り込み処理についてよく理解してから使用すること

	既定値は %xxxxxxxx_xxxxx011_11011111_00000000（ x：無効ビット ）


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１８：多重／単音モードの設定				機能コード $01FC
─────────────────────────────────────

機能：	多重再生を許可／禁止する

呼出：	D0.W	$01FC

	D1.W	＝ -1	：取得のみ
		＝ 0	：多重再生禁止（単音モード）
		＝ 1	：多重再生許可
		＝ 2	：ファンクションコールのみ多重再生許可

戻値：	D0.L	＝ 0	：多重再生禁止中
		＝ 1	：多重再生許可中
		＝ 2	：ファンクションコールのみ多重再生許可中
		変更前の設定状態が戻値となる

	多重再生禁止中は、ＩＯＣＳ出力及びファンクションによる出力は後から
	行われたものが有効となる
	多重再生許可状態（ 1 または 2 ）から多重再生禁止状態（ 0 ）、また
	はその逆へ切り替えた場合、全チャンネルを初期化する


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１９：（reserved）					機能コード $01FD
─────────────────────────────────────

	本コールは予約されています


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２０：占有						機能コード $01FE
─────────────────────────────────────

機能：	ＰＣＭ８Ａを占有し、常駐解除を禁止する

呼出：	D0.W	$01FE

戻値：	D0.L	＝ 0	：占有した
		＝ -1	：既に占有されている

	一般のプログラムでは使ってはならない


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２１：占有解除						機能コード $01FF
─────────────────────────────────────

機能：	ＰＣＭ８Ａの占有を解除し、常駐解除を可能にする

呼出：	D0.W	$01FF

戻値：	D0.L	＝ 0	：占有解除した
		＝ -1	：占有されていない

	一般のプログラムでは使ってはならない


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２２：ＰＣＭ８Ａ割り込みフラグチェック			機能コード $FFF0
─────────────────────────────────────

機能：	ＰＣＭ８Ａが割り込み処理中かチェックする

呼出：	D0.W	$FFF0

戻値：	D0.L	＝ 0	：割り込み処理中ではない
		≠ 0	：割り込み処理中

	一般のプログラムでは使ってはならない


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２３：ＰＣＭ８Ａ内部初期化				機能コード $FFF1
─────────────────────────────────────

機能：	ＰＣＭ８Ａの全チャンネルと内部ワークを初期化する

	動作モードは変わらない

呼出：	D0.W	$FFF1

戻値：	D0.L	＝ 0	：正常終了

	一般のプログラムでは使ってはならない


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２４：使用ベクタ問い合わせ				機能コード $FFFD
─────────────────────────────────────

機能：	ＰＣＭ８Ａで使用しているベクタの情報を取得する

呼出：	D0.W	$FFFD

	D1.W	ベクタ番号

戻値：	D0.L	＝ -1	：使用していないベクタ番号である
		＝ -2	：組み込まれていないため、未使用である
		上記以外：元のベクタアドレス

	一般のプログラムでは使ってはならない

	ＰＣＭ８Ａで使用しているベクタは以下の通りです

		番号
		$0022	TRAP #2
		$006A	DMAC ch.3 通常割り込み
		$006B	DMAC ch.3 エラー割り込み
		$0160	IOCS _ADPCMOUT
		$0161	IOCS _ADPCMINP
		$0162	IOCS _ADPCMAOT
		$0163	IOCS _ADPCMAIN
		$0164	IOCS _ADPCMLOT
		$0165	IOCS _ADPCMLIN
		$0166	IOCS _ADPCMSNS
		$0167	IOCS _ADPCMMOD


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２５：（reserved）					機能コード $FFFE
─────────────────────────────────────

	本コールは予約されています


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２６：常駐解除						機能コード $FFFF
─────────────────────────────────────

機能：	ＰＣＭ８Ａの常駐を解除する

呼出：	D0.W	$FFFF

戻値：	D0.L	＝ 0	：常駐が正常に解除された
		＝ -1	：占有されており、解除できなかった
		＝ -2	：ベクタが変更されており、解除できなかった

	一般のプログラムでは使ってはならない


※注意
	$FFF0 , $FFF1 , $FFFD のコールを使用する場合、必ず PCM8A.X が常駐
	していることを確認してから実行してください。
	PCM8.X が常駐している状態でこれらのコールを使用すると、常駐解除
	（$FFFFコール）となってしまう可能性があります。


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
４．ＰＣＭ８Ａ　ＩＯＣＳコール

	通常のＩＯＣＳとほぼ同様な手続きで利用できます。

　４−１　対象コール

	$60	_ADPCMOUT	チェーンなし出力
	$62	_ADPCMAOT	アレイチェーン出力
	$64	_ADPCMLOT	リンクアレイチェーン出力
	$66	_ADPCMSNS	ＡＤＰＣＭ実行モードセンス
	$67	_ADPCMMOD	ＡＤＰＣＭ実行制御

	ＰＣＭ８Ａは、上記以外のＡＤＰＣＭ関連のコールも全て管理します。

　４−２　元のＩＯＣＳとの差異

　　４−２−１　多重再生モード

	（１）前の音の出力中に、続いて出力を行った場合、前の音の出力終了を
	　　　待たず、他のチャンネルを使用して出力を合成します。

	　　　この場合、空いているチャンネルを、チャンネル番号の大きいもの
	　　　から順に使用します。
	　　　このとき、空きのない場合は、チェーンなし出力中のチャンネルの
	　　　内、残り時間の一番短いものを潰して出力します。
	　　　それでも該当するチャンネルが無い場合コールは無視し、復帰値を
	　　　D0.L ＝ -1 としてリターンします。

	　　　チャンネルサーチでは、チャンネル一時停止（$00Bxコール）等で
	　　　一時停止状態にあるチャンネルでも空いていると判断して、勝手に
	　　　出力を割り当ててしまうので注意が必要です。

	（２）通常出力（$60コール）では、出力バイト数が $FF00 以上でもすぐ
	　　　リターンします。

	（３）定位は最新の指定に従いますが、出力カットの指定は無視します。
	　　　定位変更時は先に出力中の残響も影響を受けてしまいます。

	（４）ＡＤＰＣＭ実行制御（$67コール）で終了を指定すると、チェーン
	　　　動作の終了となります。
	　　　このとき、現在出力中のデータブロックはそのまま出力されます。
	　　　即時終了する場合は、中止指定を行ってから終了を指定すること。

	　　　中止指定の後、終了指定または他の音の再生指定を行うと、元の出
	　　　力は全てキャンセルされます。
	　　　中止指定後は再開指定による継続出力も可能ですが、キャンセルさ
	　　　れた出力の継続出力はできません。

	　　　なお、ファンクションコールによる出力は、本コールによる影響を
	　　　受けません。

	（５）ＡＤＰＣＭ実行モードセンス（$66コール）は、最後に行われた
	　　　ＩＯＣＳコール出力の状態を返します。

　　４−２−２　単音再生モード

	（１）前の音の出力中に、続いて出力を行った場合、前の音の出力終了を
	　　　待たず、前の音の出力を取り消して出力します。

	（２）通常出力（$60コール）では、出力バイト数が $FF00 以上でもすぐ
	　　　リターンします。

　　４−２−３　その他

	（１）IOCS コールでは、16bit PCM , 8bit PCM の入出力はできません。

	（２）IOCS コールの音量は原音固定です。


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
５．ＰＣＭ８Ａ常駐判定方法

	ＰＣＭ８Ａファンクションコールを使用する場合は、予め常駐判定を行っ
	ておく必要があります。

	常駐判定には、以下の方式を推奨します。

　５−１　トラップベクタ取得方式

	例外ベクタ $0022（ trap #2 エントリ：絶対番地＝ $0088 ）の内容で示
	されたアドレスの手前１６バイトをチェックします。

	先頭から５バイトが 'PCM8A' で、３バイトスキップして、続く８バイト
	が 'PCM8/048' ならば常駐しています。
	なお、スキップした３バイトはバージョンです。
	（ 例：version 0.43 = 'PCM8A043PCM8/048' ）

　５−２　ＩＯＣＳコール方式（簡略方式）

	D1.L に 定数 'PCMA' を設定して、IOCS $67（_ADPCMMOD）を実行し、戻
	り値 D0.L ≧ 0 であれば PCM8A は常駐しており、バージョンは
	 D0.L / 100（10進）です。


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
６．注意事項／他

　６−１　ＯＰＭレジスタアクセスについて

	ＰＣＭ８Ａは、ＯＰＭレジスタをアクセスする場合があります。

	アクセスレジスタは $1B で、システムワーク $09DA を参照して値を決定
	するため、他のアプリケーションではシステムワークと実際の設定内容の
	食い違いが起こらないように注意する必要があります。

　６−２　ＰＣＭ８Ａ組み込み制御について

	音源ドライバが独自にＡＤＰＣＭ処理を行う場合など、後からＰＣＭ８Ａ
	が組み込まれると都合が悪い場合は、trap #2 のエントリ（絶対番地＝
	$0088）にダミーのアドレス（$00F00000 未満）を設定しておくと、ＰＣ
	Ｍ８Ａの組み込みを禁止できます。

　６−３　システムワーク $0C32 について

	ＲＯＭ内部ルーチンによる処理では、$0C32 にはＡＤＰＣＭの動作状態が
	格納されていますが（$00,$02,$04,$12,$14,$22,$24,$82,$84 のいずれか
	の値が入る）、ＰＣＭ８ＡがＡＤＰＣＭを管理している状態では、ここに
	 $42 を格納します。

　６−４　過負荷状態について

	過負荷状態とは、ＰＣＭ８Ａの割込み処理が 6.144ms以内に終了しなかっ
	たために、ＡＤＰＣＭ出力が停止してしまう状態を指します。

	この状態になる原因としては、ＰＣＭ８Ａの割り込み処理中に入った別の
	割り込み処理の時間が長い場合や、割り込みレベル３以上の時間が長く
	なった等の理由で、長時間（6.144ms）ＰＣＭ８Ａの割込み処理が禁止さ
	れてしまった場合が考えられます。

	なお、ＰＣＭ８Ａは過負荷状態になると、出力処理を数回繰り返し、過負
	荷状態が一時的なものであればそのまま出力を継続しますが、過負荷状態
	から回復しない場合には、全チャンネルの出力を強制的に停止します。
	（ PCM8.X では一度過負荷状態になると、即座に出力を停止してしまいま
	　す）

	また、過負荷状態になるとノイズが出力されたり、出力の音量が不自然に
	変化してしまうため、過負荷状態での使用は避けてください。

　６−５　多重割り込みについて

	ＰＣＭ８Ａの割り込み処理中に更に割り込みが入り、その割り込み処理か
	ら出力命令が実行されても正常に動作します。
	（ PCM8.X ではこのような場合、出力命令が正常に受け付けられないこと
	　がありました）

	なお、動作モードの切り替え（多重再生モードと、単音再生モードの切り
	替え）や入力命令（ＩＯＣＳの _ADPCMINP, _ADPCMAIN, _ADPCMLIN）は、
	ＰＣＭ８Ａの割込み処理中に実行しないでください。

　６−６　出力停止状態について

	ＡＤＰＣＭ／ＰＣＭデータのポインタとしてメモリの存在しないアドレス
	を指定したために、ＰＣＭ８Ａの割り込み処理中にバスエラーを起こした
	場合や、INTERRUPT スイッチでＰＣＭ８Ａの割り込み処理中に停止させ、
	そのまま割り込み処理から抜けてしまった場合には、ＰＣＭ８Ａ内部の割
	り込み処理フラグが立ったままとなり、出力ができない状態になります。

	この状態になると、明らかにＰＣＭ８Ａの割り込み処理状態でなくても
	（割り込み処理ルーチンでなく、割り込みを禁止していないプログラムか
	らでも）、$FFF0 コール（ＰＣＭ８Ａ割り込みフラグチェック）で割り込
	み処理中のステータスが返ってきます。

	こうなった場合、コマンドラインから PCM8A CLR と入力すれば復帰しま
	す。
	また、割り込み処理でないプログラムからスーパーバイザモードで、以下
	のようなプログラムを実行することで復帰させることもできます。

		move.w	sr,-(sp)
		ori.w	#$0700,sr	割り込み禁止
		moveq	#$F0,d0
		trap	#2		割り込み処理中フラグチェック
		tst.l	d0
		beq	OK		正常なら何もしない
		moveq	#$F1,d0
		trap	#2		出力が停止しているので内部初期化
	OK:	move.w	(sp)+,sr	割り込み許可


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
７．音量変換の詳細について

	音量変換の詳細情報は以下の通りです。

　　音量設定値	レベル	　dB		ADPCM 倍率	PCM 倍率※

	$40	-64	-53.0		0.0022		0.0024	(5/2048)
	$41	-63	-52.2		0.0025		　↑
	$42	-62	-51.3		0.0027		0.0029	(3/1024)
	$43	-61	-50.5		0.0030		　↑
	$44	-60	-49.7		0.0033		　↑
	$45	-59	-48.8		0.0036		0.0039	(1/256)
	$46	-58	-48.0		0.0040		　↑
	$47	-57	-47.2		0.0044		　↑
	$48	-56	-46.4		0.0048		0.0049	(5/1024)
	$49	-55	-45.5		0.0053		　↑
	$4A	-54	-44.7		0.0058		0.0059	(3/512)
	$4B	-53	-43.9		0.0064		　↑
	$4C	-52	-43.0		0.0070		0.0078	(1/128)
	$4D	-51	-42.2		0.0077		　↑
	$4E	-50	-41.4		0.0085		　↑
	$4F	-49	-40.6		0.0094		0.0098	(5/512)
	$50	-48	-39.7		0.010		　↑
	$51	-47	-38.9		0.011		0.012	(3/256)
	$52	-46	-38.1		0.012		　↑
	$53	-45	-37.3		0.014		　↑
	$54	-44	-36.4		0.015		0.016	(1/64)
	$55	-43	-35.6		0.016		　↑
	$56	-42	-34.8		0.018		　↑
	$57	-41	-33.9		0.020		0.023	(3/128)
	$58	-40	-33.1		0.022		　↑
	$59	-39	-32.3		0.024		　↑
	$5A	-38	-31.5		0.026		　↑
	$5B	-37	-30.6		0.029		0.031	(1/32)
	$5C	-36	-29.8		0.032		　↑
	$5D	-35	-29.0		0.035		0.039	(5/128)
	$5E	-34	-28.1		0.039		　↑
	$5F	-33	-27.3		0.043		0.047	(3/64)
	$60	-32	-26.5		0.047		　↑
	$61	-31	-25.7		0.052		　↑
	$62	-30	-24.8		0.057		0.063	(1/16)
	$63	-29	-24.0		0.063		　↑
	$64	-28	-23.2		0.069		0.078	(5/64)
	$65	-27	-22.3		0.076		　↑
	$66	-26	-21.5		0.084		0.094	(3/32)
	$67	-25	-20.7		0.092		　↑
	$68	-24	-19.9		0.10		　↑
	$69	-23	-19.0		0.11		0.13	(1/8)
	$6A	-22	-18.2		0.12		　↑
	$6B,$00	-21	-17.4		0.13		　↑
	$6C	-20	-16.6		0.15		0.16	(5/32)
	$6D	-19	-15.7		0.16		　↑
	$6E	-18	-14.9		0.18		0.19	(3/16)
	$6F,$01	-17	-14.1		0.20		　↑
	$70	-16	-13.2		0.21		0.25	(1/4)
	$71,$02	-15	-12.4		0.24		　↑
	$72	-14	-11.6		0.26		　↑
	$73	-13	-10.8		0.29		0.31	(5/16)
	$74,$03	-12	-9.9		0.32		　↑
	$75	-11	-9.1		0.35		0.38	(3/8)
	$76,$04	-10	-8.3		0.39		　↑
	$77	-9	-7.5		0.42		　↑
	$78	-8	-6.6		0.47		0.50	(1/2)
	$79,$05	-7	-5.8		0.51		　↑
	$7A	-6	-5.0		0.56		0.63	(5/8)
	$7B,$06	-5	-4.1		0.62		　↑
	$7C	-4	-3.3		0.68		　↑
	$7D,$07	-3	-2.5		0.75		0.75	(3/4)
	$7E	-2	-1.7		0.83		　↑
	$7F	-1	-0.8		0.91		1.00

	$80,$08	 0	 0		1.00		1.00

	$81	+1	+0.8		1.10		1.00
	$82,$09	+2	+1.7		1.21		1.25	(5/4)
	$83	+3	+2.5		1.33		　↑
	$84,$0A	+4	+3.3		1.46		1.50	(3/2)
	$85	+5	+4.1		1.61		　↑
	$86	+6	+5.0		1.77		2.00
	$87,$0B	+7	+5.8		1.95		　↑
	$88	+8	+6.6		2.14		　↑
	$89	+9	+7.5		2.36		2.50	(5/2)
	$8A,$0C	+10	+8.3		2.60		　↑
	$8B	+11	+9.1		2.85		3.00
	$8C,$0D	+12	+9.9		3.14		　↑
	$8D	+13	+10.8		3.46		　↑
	$8E	+14	+11.6		3.80		4.00
	$8F,$0E	+15	+12.4		4.18		　↑
	$90	+16	+13.2		4.61		5.00
	$91,$0F	+17	+14.1		5.06		　↑
	$92	+18	+14.9		5.56		6.00
	$93	+19	+15.7		6.13		　↑
	$94	+20	+16.6		6.75		　↑
	$95	+21	+17.4		7.43		8.00
	$96	+22	+18.2		8,17		　↑
	$97	+23	+19.0		8.97		　↑
	$98	+24	+19.9		9.89		10.00
	$99	+25	+20.7		10.85		　↑
	$9A	+26	+21.5		11.94		12.00
	$9B	+27	+22.3		13.15		　↑
	$9C	+28	+23.2		14.50		16.00
	$9D	+29	+24.0		16.00		　↑
	$9E	+30	+24.8		17.64		　↑
	$9F	+31	+25.7		19.40		20.00
	$A0	+32	+26.5		21.26		　↑

	※８ビットＰＣＭでは $40〜$53 は倍率が 0 になります


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
